\documentclass[%
    10pt,
    professionalfont,
    aspectratio=169,
    handout,
]{beamer}

\mode<presentation>{%
    \usetheme[alternativetitlepage=bild]{Rub}
    \titlegraphic{img-bg-rub.jpg}
    \setbeamercovered{invisible}
}
\usepackage{pgfpages}
\setbeameroption{show notes on second screen}
\setbeamertemplate{theorems}[numbered]

\usepackage{rubfonts2009}
\usepackage[charter]{mathdesign}
\SetMathAlphabet{\mathcal}{normal}{OMS}{zplm}{m}{n}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{graphicx}
\definecolor{gelbgruen}{cmyk}{0.5,0,1,0}
\definecolor{lichtgrau}{cmyk}{0.03,0.03,0.03,0.1}
\definecolor{saphierblau}{cmyk}{1,0.5,0,.6}
\definecolor{ucorange}{cmyk}{0,0.45,0.93,0.04}
\definecolor{alertred}{rgb}{0.80,0.12,0.12}

\usepackage{abbrv}
\usepackage{delimiters}

\usepackage[english]{babel}
\usepackage{csquotes}

\usepackage{amsmath}
\usepackage{mathtools}

\usepackage{etoolbox,siunitx}
\sisetup{binary-units}

\usepackage{booktabs}

\usepackage{setspace}
\usepackage{todonotes}

\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\newcommand*\Let[2]{\State{} #1 $\gets$ #2}
\algrenewcommand\alglinenumber[1]{%
    {\sffamily\footnotesize#1}}
\algrenewcommand\algorithmicrequire{\textbf{Input:}}
\algrenewcommand\algorithmicensure{\textbf{Output:}}

\usepackage{accsupp}
\usepackage{listings}

\newcommand{\noncopynumber}[1]{%
    \BeginAccSupp{method=escape,ActualText={}}
    #1
    \EndAccSupp{}
}

\usepackage{tikz}
\usepackage{tikzsymbols}
\usetikzlibrary{backgrounds}
\usetikzlibrary{calc}
\usetikzlibrary{positioning}
\usetikzlibrary{decorations.pathreplacing, overlay-beamer-styles}
\usetikzlibrary{shapes}

\usetikzlibrary{chains,shapes.arrows,fit}
\definecolor{arrowcolor}{RGB}{201,216,232}% color for the arrow filling
\definecolor{circlecolor}{RGB}{79,129,189}% color for the inner circles filling
\colorlet{textcolor}{white}% color for the text inside the circles
\colorlet{bordercolor}{white}% color for the outer border of circles

\usetikzlibrary{crypto.symbols}
\tikzset{shadows=no}        % Option: add shadows to XOR, ADD, etc.
\usepackage{pgfplots}
\usetikzlibrary{pgfplots.colormaps}


\newcommand{\repeatarrow}{%
    \begin{tikzpicture}[inner sep=0pt, baseline=(base)]%
    \node (n) {};
    \draw[thick,<-] (n.center) ++(110:0.6em) arc (110:430:0.6em);
    \node (base) at (0,-.5ex) {};
    \end{tikzpicture}%
}

\usepackage[beamer]{hf-tikz}
\usepackage{forest}

\tikzset{%
    invisible/.style={opacity=0,text opacity=0},
    visible on/.style={alt={#1{}{invisible}}},
    alt/.code args={<#1>#2#3}{%
        \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
    },
    marked/.style={
        color=alertred,
    },
    marked on/.style={alt=#1{marked}{}},
}
\forestset{%
    visible on/.style={%
        for tree={%
            /tikz/visible on={#1},
            edge+={/tikz/visible on={#1}}
        }
    }
}

\def\colorize<#1>{%
    \temporal<#1>{\color{black}}{\color{alertred}}{\color{black!50}}%
}



\pgfdeclarelayer{background}
\pgfsetlayers{background,main}

\colorlet{arrowcolor}{saphierblau}
\colorlet{circlecolor}{white}
\colorlet{bordercolor}{gelbgruen}
\colorlet{textcolor}{saphierblau}


\setbeamertemplate{bibliography item}[text]
\usepackage[%
    backend=biber,
    bibencoding=ascii,
    style=alphabetic,
    sortcites,
    sorting=ynt,
    hyperref=true,
    maxbibnames=10,
    maxcitenames=5,
    giveninits=true,
]{biblatex}
\DefineBibliographyStrings{english}{%
    andothers = {\etal/}
}
\DeclareFieldFormat{eprint:iacr}{%
\mkbibacro{iacr}\addcolon\space{}
    \href{https://eprint.iacr.org/#1}{\nolinkurl{#1}}
}
\DeclareFieldFormat{eprint:iacrconf}{%
\mkbibacro{iacr}\addcolon\space{}
    \href{https://www.iacr.org/archive/#1}{\nolinkurl{#1}}
}
\renewcommand\bibfont{\scriptsize}
\bibliography{abbrev3,bibliography}

\hypersetup{%
    colorlinks=true,
    citecolor=black!70!green,
    linkcolor=black!70!red,
    urlcolor=black!20!blue,
}

\newrobustcmd*{\fullfullcite}{%
    \AtNextCite{%
        \AtEachCitekey{%
            \defcounter{maxnames}{99}%
            \DeclareNameAlias{labelname}{given-family}%
        }%
    }%
    \fullcite
}

\newcommand{\blfootnote}[1]{%
    \begingroup
        \renewcommand\thefootnote{}\footnote{#1}%
        \addtocounter{footnote}{-1}%
    \endgroup
}
\newcommand{\vpPp}{\vphantom{Pp}}
\newcommand{\coset}[2]{#1 \!\! + \!\! #2}
\newcommand{\through}[1]{\stackrel{#1}{\rightarrow}}
\newcommand\tower[2]{\genfrac{}{}{0pt}{}{#1}{#2}}
\DeclareMathOperator*{\Prob}{Pr}

\newcommand{\F}{\mathbb{F}}
\newcommand{\derive}[2]{\Delta_{#1}\parens{#2}}
\renewcommand{\iprod}[2]{\angles{#1, #2}}
\DeclareMathOperator*{\diffOp}{\rightarrow}
\newcommand{\propDiff}[4]{#1 \diffOp^{#2}_{#3} #4}
\DeclareMathOperator{\ImOp}{Im}
\renewcommand{\Im}[1]{\ImOp {#1}}
\DeclareMathOperator{\SpanOp}{Span}
\newcommand{\Span}[1]{\SpanOp\set{#1}}

\makeatletter
\def\maxwidth#1{\ifdim\Gin@nat@width>#1 #1\else\Gin@nat@width\fi}
\def\maxheight#1{\ifdim\Gin@nat@height>#1 #1\else\Gin@nat@height\fi}
\makeatother

\def\printcipher/{PRINTcipher}
\def\robin/{Robin}
\def\iscream/{iSCREAM}
\def\scream/{SCREAM}
\def\midori/{Midori}
\def\misty/{Misty}
\def\zorro/{Zorro}
\def\spook/{\textsf{Spook}}
\def\clyde/{Clyde}
\def\shadow/{Shadow}

\title{Security Arguments and\\ Tool-based Design of Block Ciphers}
\subtitle{PhD Defense}
\author{Friedrich Wiemer}
\institute{%
    %SymCrypt, HGI, RUB
    Workgroup Symmetric Cryptography, Horst-GÃ¶rtz-Institute for IT-Security, Ruhr University Bochum
}

\date[December 13th, 2019]{\small{}December 13th, 2019}

\begin{document}

\begin{frame}[plain]
    \titlepage{}
\end{frame}

\section{Introduction}
\begin{frame}{Topics of the Thesis}
    \setbeamercovered{transparent}
    \centering
    Based on mainly four papers:\\
    \begin{minipage}{0.47\textwidth}
        \centering
        \begin{block}{Security Arguments}
            \uncover<1>{%
            \begin{itemize}
                \item \fullcite{dlct}
                \item \fullcite{bison}
            \end{itemize}
            }
        \end{block}
    \end{minipage}%
    \hspace{5pt}%
    \begin{minipage}{0.48\textwidth}
        \centering
        \begin{block}{Tool-based Design}
            \begin{itemize}
                \uncover<1>{  \item \fullcite{xorcounts}}
                \uncover<1-2>{\item \fullcite{subspacetrails}}
            \end{itemize}
        \end{block}
    \end{minipage}
\end{frame}

\begin{frame}{The General Setting}{Block Ciphers and Security Notion}
    \centering
    \begin{block}{Definition: Block Cipher}
    \begin{minipage}{0.50\textwidth}
        \begin{itemize}
            \item $E : \mathcal{K} \times \mathcal{M} \to \mathcal{C}$ family of permutations, with
                \vspace{-5pt}
                \begin{gather*}
                    \mathcal{K}\ \text{the key space,}\ \mathcal{M}\ \text{the message space,}\\
                    \text{and}\ \mathcal{C}\ \text{the cipher space}
                \end{gather*}
        \end{itemize}
    \end{minipage}%
    \hspace{5pt}%
    \begin{minipage}{0.45\textwidth}
        \begin{itemize}
            \item In practice: $\mathcal{K} = \F_2^s$ and $\mathcal{M} = \mathcal{C} = \F_2^n$.\\
                  $E_k = E(k, \cdot)$ the \emph{encryption} under key $k$,\\
                  $D_k = E_k^{-1}$ the \emph{decryption},\\
                  $s$ the \emph{key length} and $n$ the \emph{block lengh}.
        \end{itemize}
    \end{minipage}
    \end{block}

    \pause
    Further let $\mathrm{Perm}_n = \set{f : \F_2^n \to \F_2^n \given f\ \text{is permutation}}$ the set of $n$-bit permutations.

    \begin{block}{Definition: Security}
        A block cipher $E$ is $(q,t,\varepsilon)$-\emph{secure}, if the (CPA)-advantage of every $(q,t)$-adversary is bound by $\varepsilon$:
        \begin{equation*}
            \mathrm{Adv}^{\text{PRP-CPA}}_{E}(\mathcal{A}_{q,t}) \coloneqq \abs{\Prob_{k \in_R \F_2^s}[\mathcal{A}^{E_k}_{q,t} = 1] - \Prob_{f \in_R \mathrm{Perm}_n}[\mathcal{A}^{f}_{q,t} = 1]} \leqslant \varepsilon\;.
        \end{equation*}
    \end{block}
    \pause

    \vfill
    In practice: security of a block cipher always security against known attacks.
\end{frame}

\begin{frame}{Substitution Permutation Networks}{The most common design structure for block ciphers}
    \begin{minipage}{0.475\textwidth}
    \begin{block}{Exemplary SPN Structure}
        \centering
        \vspace{2pt}
        \begin{tikzpicture}

        \foreach \z in {0,...,3} {
            \node[] (i\z) at ($(-0.25, \z*3em)+(0,0.35)$) {};
            \node[] (o\z) at ($\z*(0, 3em)+(18.25em,0.35)$) {};
            \draw[thick,solid] (i\z) -- (o\z.center);
        }

        %% Round 1
        %% SBoxes
        \foreach \z in {0,...,3} {
            \node[draw,thick,solid,minimum width=2em,minimum height=2.75em,fill=white] (sl\z) at ($(0,\z*3em) + (2em,1.1em)$) {$S$};
        }
        %% Permutation Box
        \node[draw,thick,solid,minimum width=2em,minimum height=11.75em,fill=white] (p1) at ($(1.125em,0) + (3.125em,5.6em)$) {$P$};

        %% Round 2
        %% SBoxes
        \foreach \z in {0,...,3} {
            \node[draw,thick,solid,minimum width=2em,minimum height=2.75em,fill=white] (sm\z) at ($(2.125,\z*3em) + (2em,1.1em)$) {$S$};
        }
        %% Permutation Box
        \node[draw,thick,solid,minimum width=2em,minimum height=11.75em,fill=white] (p2) at ($(5.5125em,0) + (4.8em,5.6em)$) {$P$};

        %% Round 3
        %% SBoxes
        \foreach \z in {0,...,3} {
            \node[draw,thick,solid,minimum width=2em,minimum height=2.75em,fill=white] (sr\z) at ($(4.25,\z*3em) + (2em,1.1em)$) {$S$};
        }
        %% Permutation Box
        \node[draw,thick,solid,minimum width=2em,minimum height=11.75em,fill=white] (p3) at ($(11.525em,0) + (4.8em,5.6em)$) {$P$};
        \end{tikzpicture}
    \end{block}
    \end{minipage}%
    \hspace{5pt}
    \begin{minipage}{0.475\textwidth}
        \begin{itemize}
            \item S-box $S : \F_2^n \to \F_2^n$ provides \emph{confusion} and non-linearity on small blocks (typically $3 \leqslant n \leqslant 8$)
            \item Linear layer $P : \F_2^{tn} \to \F_2^{tn}$ provides \emph{diffusion} and spreads the S-box influence over the whole state
            \item Key-alternating: the round keys are added in between the rounds
        \end{itemize}
    \end{minipage}
    \vfill
\end{frame}

\begin{frame}{Overview}
    \tableofcontents[currentsection,sectionstyle=shaded/show]{}
\end{frame}

\section{Subspace Trail Attack}
\begin{frame}{Subspace Trail Cryptanalysis}
    \centering
    \begin{minipage}{0.47\textwidth}
    \begin{block}{Idea: Subspace Trails}
        \centering
        \vspace{0.25em}
        \begin{tikzpicture}[scale=0.8]
            \tikzstyle{every node}=[transform shape];

            \node (left2-space) [draw,rectangle,thick,rounded corners,minimum width=3cm,minimum height=4cm,fill=white] at (1,0) {};
            \draw[thick] (left2-space.west)+(0,1.125cm) -- node[above, yshift=1.5mm] {$\coset{U}{a_r}$} +(3cm,1.125cm);
            \draw[thick] (left2-space.west)+(0,-0.25cm) -- node[above, yshift=5mm] {\dots} +(3cm,-0.25cm);
            \draw[thick] (left2-space.west)+(0,-1.125cm) -- node[above, yshift=1.5mm] {$\coset{U}{a_1}$}
                                                            node[below, yshift=-1.5mm] {$U$} +(3cm,-1.125cm);

            \node (middle-space) [draw,rectangle,thick,rounded corners,minimum width=3cm,minimum height=4cm,fill=white] at (5,0) {};
            \draw[thick] (middle-space.north)+(0pt,-0.5pt) -- node[above, yshift=0.5mm, rotate=45] (vbs) {$\coset{V}{b_s}$} +(-1.5cm,-1.5cm);
            \draw[thick] (middle-space.east)+(-0.5pt,1cm) -- node[above, yshift=10mm, rotate=45] (middle-dots) {\dots} +(-3cm+1.25pt,-2cm+1.25pt);
            \draw[thick] (middle-space.east)+(-0.5pt,-5mm) -- node[above, yshift=2.5mm, rotate=45] (vb1) {$\coset{V}{b_1}$}
                                                        node[below, yshift=-0.5mm, rotate=45] (v) {$V$} +(-1.5cm,-2cm);

            \draw[-latex] (1.75,-1.5) to [bend left] (4.75,-1.5);
            \visible<2->{%
            \draw[-latex] (1.75,-0.5) to [bend left] (6.325,-1.0);
            \draw[-latex] (1.75,+1.5) to [bend left] (middle-dots);
            }

            \node (left-f) at (3,0) {$F$};
        \end{tikzpicture}
    \end{block}
    \end{minipage}%
    \hspace{5pt}%
    \begin{minipage}{0.47\textwidth}
    \visible<3->{
    \begin{block}{Def.: Subspace Trails~[GRR16] (FSE'16)}
        \vspace{7pt}
        Let $U_0, \ldots, U_r \subseteq \F_2^n$, and $F : \F_2^n \to \F_2^n$.
        If
        \begin{equation*}
            \forall a \in U_i^\perp : \exists b \in U_{i+1}^\perp : \quad F(\coset{U_i}{a}) \subseteq \coset{U_{i+1}}{b}\;,
        \end{equation*}
        these subspaces form a \emph{subspace trail} (ST).\\[7pt]
        Notation: $\propDiff{U_0}{F}{}{\propDiff{\cdots}{F}{}{U_r}}$.
        \vspace{9.5pt}
    \end{block}
    }
    \end{minipage}%

    \visible<3->{
        \vspace{10pt}
        (We only look at the probability-one variant here)
    }
\end{frame}

\begin{frame}{The Problem/Our Goal}
    \centering
    \vfill
    Find a solution to
    \vfill
    \begin{block}{Problem: Security against Subspace Trails}
        Given an SPN with round function $F$, consisting of
        \begin{itemize}
            \item $t$ parallel applications of an S-box $S : \F_2^n \to \F_2^n$ and
            \item a linear layer $L : \F_2^{tn} \to \F_2^{tn}$.
        \end{itemize}
        Compute an upper bound on the length of any subspace trail through the cipher.
    \end{block}
    \vfill
\end{frame}

\section{Propagating Subspaces}
\begin{frame}{Subspace Propagation}
    \centering
    \begin{minipage}{0.48\textwidth}
    Given a starting subspace $U$, we can efficiently compute the corresponding longest subspace trail.

    \begin{lemma}
        \vspace{5pt}
        Let $U \through{F} V$ be a subspace trail.
        Then
        \begin{equation*}
            \forall u \in U, x \in \F_2^m: \derive{u}{F}(x) \coloneqq F(x) + F(x + u) \in V\;.
        \end{equation*}
        \vspace{0pt}
    \end{lemma}
    This implies $\Span{\bigcup_{u \in U} \Im{\derive{u}{F}}} \subseteq V$.
    \end{minipage}%
    \hspace{15pt}%
    \begin{minipage}{0.40\textwidth}
    \visible<2->{%
    \begin{block}{Proof}
        \centering
        \begin{tikzpicture}[scale=0.75]
            \tikzstyle{every node}=[transform shape];

            \node (left2-space) [draw,rectangle,thick,rounded corners,minimum width=3cm,minimum height=4cm,fill=white] at (1,0) {};
            \draw[thick] (left2-space.west)+(0,1.125cm) -- node[above, yshift=1.5mm] {$\coset{U}{a_s}$} +(3cm,1.125cm);
            \draw[thick] (left2-space.west)+(0,-0.25cm) -- node[above, yshift=5mm] {\dots} +(3cm,-0.25cm);
            \draw[thick] (left2-space.west)+(0,-1.125cm) -- node[below, yshift=-1.5mm] {$U$} +(3cm,-1.125cm);

            \node (right2-space) [draw,rectangle,thick,rounded corners,minimum width=3cm,minimum height=4cm,fill=white] at (5,0) {};
            \draw[thick] (right2-space.north)+(0pt,-0.5pt) -- node[above, yshift=0.5mm, rotate=45] {$\coset{V}{b_t}$} +(-1.5cm,-1.5cm);
            \draw[thick] (right2-space.east)+(-0.5pt,1cm) -- node[above, yshift=10mm, rotate=45] {\dots} +(-3cm+1.25pt,-2cm+1.25pt);
            \draw[thick] (right2-space.east)+(-0.5pt,-5mm) -- node[below, yshift=-0.5mm, rotate=45] {$V$} +(-1.5cm,-2cm);

            \node[xshift=-20pt, yshift=-18pt] (x1) at (left2-space) {$\cdot$};
            \node[above] (x1-label) at (x1) {$x$};

            \node[xshift=32pt, yshift=-4pt] (y1) at (right2-space) {$\cdot$};
            \node[above] (y1-label) at (y1) {$F(x)$};

            \draw[-latex] (x1) to [bend left] node[below,yshift=-5pt] {$F$} (y1);

            \visible<3->{%
                \node[xshift=25pt, yshift=-24pt] (x2) at (left2-space) {$\cdot$};
                \node[above] (x2-label) at (x2) {$x+u$};

                \node[xshift=-12pt, yshift=-42pt] (y2) at (right2-space) {$\cdot$};
                \node[below] (y2-label) at (y2) {$F(x+u)$};

                \draw[-latex] (x1) -- node[below,draw,fill=white,inner sep=1pt,circle] (u-label) {$u$} (x2);
                \node[xshift=17pt, yshift=-23pt] at (u-label) (u) {$\cdot$};

                \draw[-latex] (u-label) -- (u);

                \draw[-latex] (x2) to [bend left] (y2);
            }

            \visible<4->{%
                \draw[-latex] (y1) -- node[below,xshift=2pt,draw,fill=white,inner sep=1pt,circle] (v-label) {$v$} (y2);
                \node[xshift=22pt, yshift=-9pt] at (v-label) (v) {$\cdot$};

                \draw[-latex] (v-label) -- (v);
            }

        \end{tikzpicture}
    \end{block}
    }
    \end{minipage}
    \visible<5->{%
    \begin{minipage}{0.925\textwidth}
    \begin{block}{Computing the subspace trail}
        \begin{itemize}
            \item To compute the next subspace, we have to compute the image of the derivatives.
        \end{itemize}
    \end{block}
    \end{minipage}
    }
\end{frame}

\begin{frame}{Propagate a Basis}
    Actually it is enough to compute only the image of the derivatives in direction of U's basis vectors.
    \begin{lemma}
        Given $U \subseteq \F_2^m$ with basis $\set{b_1, \ldots, b_k}$.
        Then
        %\begin{equation*}
        $
            \Span{\bigcup_{u \in U} \Im{\derive{u}{F}}} = \Span{\bigcup_{b_i} \Im{\derive{b_i}{F}}}\;.
        $
        %\end{equation*}
    \end{lemma}
    \pause
    \begin{block}{Proof: $\supseteq$ trivial, $\subseteq$ by induction over the dimension $k$ of $U$}
        Let $u = \sum_{i=1}^k \lambda_i b_i$ and $v \in \Im{\derive{u}{F}}$, \ie/ there exists an $x$ \st/
        \begin{equation*}
            v = F(x) + F(x + \sum_{i=1}^k \lambda_i b_i)
              = F(y + \lambda_k b_k) + F(y + \sum_{i=1}^{k-1} \lambda_i b_i)
              = \lambda_k \derive{b_k}{F}(y) + \derive{u^\prime}{F}(y)\;.
        \end{equation*}
        Thus $v \in \Span{\Im{\derive{b_k}{F}} \cup \Im{\derive{u^\prime}{F}}}$, where $u^\prime$ is contained in a $(k-1)$ dimensional subspace.\hfill\qedsymbol
    \end{block}
\end{frame}

\begin{frame}{\texttt{ComputeTrail} Algorithm}
    \begin{minipage}{0.55\textwidth}
    \begin{block}{Computation of Subspace Trails}
    \begin{algorithmic}[1]
        \Require{A nonlinear function $F : \F_2^m \to \F_2^m$, a subspace~$U$.}
        \Ensure{A subspace trail $\propDiff{U}{F}{}{\propDiff{\cdots}{F}{}{V}}$.}
        \Statex{}
        \Function{\texttt{ComputeTrail}}{$F$, $U$}
        \If{$\dim U = m$} \Return{$U$} \EndIf{}
        \State{}$V \leftarrow \emptyset$
        \For{$u_i$ basis vectors of $U$}
            \For{enough $x \in_\mathrm{R} \F_2^m$}\label{st:alg:compute_trail_1line}
                \Let{$V$}{$V \cup \set{\derive{u_i}{F}(x)}$}\label{st:alg:compute_trail_2line}
            \EndFor{}
        \EndFor{}
        \State{}$V \leftarrow \Span{V}$
        \State{}\Return{$\propDiff{U}{F}{}{\texttt{ComputeTrail}(F, V)}$}
        \EndFunction{}
    \end{algorithmic}
    \end{block}
    \end{minipage}%
    \hspace*{-10pt}%
    \begin{minipage}{0.5\textwidth}
        \begin{itemize}
            \item[] Remaining Problem: cyclic STs\\[1em]
            \item[] \textbf{Correctness}: previous two lemmata
            \item[] \textbf{Runtime}:
                \begin{itemize}
                    \item Line 4: $\mathcal{O}(m)$ iterations
                    \item Line 5: $\mathcal{O}(m)$ random vectors are enough
                    \item Recursions: can stop after $\mathcal{O}(m)$ rounds
                    \item Overall: $\mathcal{O}(m^3)$ evaluations of $F$
                \end{itemize}
        \end{itemize}
    \end{minipage}
\end{frame}
\note{%
    How many random vectors are enough:
    \url{https://math.stackexchange.com/questions/564603/probability-that-a-random-binary-matrix-will-have-full-column-rank}
    Draw $n$ random vectors of length $m$, but because $n > m$ look at the probability
    \begin{equation*}
        \Prob[\text{$m$ vectors of length $n$ have rank $m$}] = \Prob[\text{$m$ vectors on length $n$ are linearly independent}]\;.
    \end{equation*}
    The uniformly at random drawn $i+1$-th vector is linearly independent of the previous $i$ vectors with probability
    \begin{equation*}
        \frac{2^n - 2^i}{2^n} = 1 - 2^{i-n}
    \end{equation*}
    and thus for all vectors up to $m$ we get the probability
    \begin{equation*}
        \prod_{i=0}^{m-1} (1-2^{i-n})\;.
    \end{equation*}
}

\section{Security for SPNs against Subspace Trail Attacks}
\begin{frame}{How to Bound the Length of Subspace Trails}
    \centering
    \begin{block}{Goal}
        Give an upper bound on the length of any subspace trail.
    \end{block}
    \pause

    \begin{minipage}{0.45\textwidth}
    \begin{block}{Na\"ive Approach 1}
        $\forall U \subseteq \F_2^m$ run $\texttt{ComputeTrail}(F, U)$
    \end{block}
    \begin{alertblock}{Problem}
        Exp.\ many ($\mathcal{O}(2^{(m^2)})$) starting subspaces.
    \end{alertblock}
    \end{minipage}%
    \pause%
    \hspace{5pt}%
    \begin{minipage}{0.48\textwidth}
    \begin{block}{Na\"ive Approach 2}
        $\forall u \in \F_2^m \setminus \set{0}$ run $\texttt{ComputeTrail}(F, \Span{u})$
    \end{block}
    \begin{alertblock}{Problem}
        Still $2^m-1$ starting subspaces.
    \end{alertblock}
    \end{minipage}
    \pause

    \begin{block}{Often used heuristic}
        Activate single S-boxes only.
        That is, for a round function with $t$ S-boxes which are $n$-bit wide, choose $U = \set{0}^{i-1} \times V \times \set{0}^{t-i}$, where $V \subseteq \F_2^n$.
    \end{block}
\end{frame}
\note{%
    How many subspaces of $\F_2^n$:
    \url{https://math.stackexchange.com/questions/70801/how-many-k-dimensional-subspaces-there-are-in-n-dimensional-vector-space-over}
    \begin{equation*}
        \sum_{r=1}^n \frac{A(n, r)}{B(n, r)} = \sum_{r=1}^n \frac{\prod_{i=1}^r (1 - 2^{n - i + 1})}{\prod_{i=1}^r (1 - 2^i)} = \sum_{r=1}^n \binom{n}{r}_2
    \end{equation*}
    $A(n, r)$: Number of subsets with $r$ linear independent elements:
    \begin{equation*}
        A(n, r) = \underbrace{(2^n - 1)}_\text{choices for first element}
        \overbrace{(2^n - 2)}^\text{choices for second element}
        \cdots
        \underbrace{(2^n - 2^{r-1})}_\text{choices for $r$-th element}
    \end{equation*}
    $B(n, r)$: Number of bases for one $r$-dimensional subspace:
    \begin{equation*}
        B(n, r) = \underbrace{(2^r - 1)}_\text{choices for first basis vector}
        \overbrace{(2^r - 2)}^\text{choices for second basis vector}
        \cdots
        \underbrace{(2^r - 2^{r-1})}_\text{choices for $r$-th vector}
    \end{equation*}
}

\begin{frame}{Activating a single S-box only}
    \begin{alertblock}{Problem}
        Heuristic not valid in general when we want to prove a bound on the subspace trail length.
        In particular one can construct examples where the best subspace trail does activate more than one S-box in the beginning.
    \end{alertblock}
    \begin{exampleblock}{The good case}
        However, we will see next a sufficient condition for the case when the heuristic is valid.
    \end{exampleblock}
\end{frame}

\begin{frame}{The Connection to Linear Structures}
    Let us observe how a single S-box $S$ behaves regarding subspace trails:
    \begin{align*}
        \intertext{Given a subpsace trail $\displaystyle\propDiff{U}{S}{}{V}$, this implies}
        \derive{u}{S}(x) &\in V \qquad \text{for all $x \in \F_2^n$ and $u \in U$.}
        \intertext{By definition of the dual space $V^\perp$:}
        \iprod{\alpha}{\derive{u}{S}(x)} &= 0 \qquad \text{for all $\alpha \in V^\perp$,}
    \end{align*}
    which are exactly the \emph{linear structures} of $S$:
    \begin{equation*}
        \mathrm{LS}(S) \coloneqq \set{(\alpha, u) \given \iprod{\alpha}{\derive{u}{S}(x)}\ \text{is constant for all $x$}}
    \end{equation*}
\end{frame}

\begin{frame}{S-boxes without Linear Structures}
    \begin{minipage}{0.48\textwidth}
    This observation implies that S-boxes without linear structures (\eg/ the AES S-box) exhibit only two important subspace trails:
    \begin{equation*}
        \propDiff{\set{0}}{}{}{\set{0}} \qquad \text{and} \qquad \propDiff{\F_2^n}{}{}{\F_2^n}
    \end{equation*}
    We can further show that subspace trails over an S-box layer without linear structures are direct products of the above two subspace trails.
    \end{minipage}\hspace{15pt}%
    \pause%
    \begin{minipage}{0.45\textwidth}
    \begin{theorem}
        Let $F$ be an S-box layer of $t$ parallel S-boxes $S : \F_2^n \to \F_2^n$.
        If $S$ has no non-trivial linear structures, then for every subspace trail $\propDiff{U}{F}{}{V}$:
        \begin{equation*}
            U = V = U_1 \times \cdots \times U_t\;,
        \end{equation*}
        with $U_i \in \set{\set{0}, \F_2^n}$.
    \end{theorem}
    \end{minipage}
    \pause

    \begin{block}{Proof}
        \vspace*{-25pt}
        \begin{equation*}
            \text{For all $\alpha = (\alpha_1, \ldots, \alpha_t) \in V^\perp$:} \quad
            \iprod{\alpha}{\derive{u}{F}(x)}
            %= \iprod{\begin{psmallmatrix}\alpha_1 \\ \vdots \\ \alpha_t\end{psmallmatrix}}{\begin{psmallmatrix}\derive{u_1}{S}(x_1) \\ \vdots \\ \derive{u_t}{S}(x_t)\end{psmallmatrix}}
            = \sum_{i=1}^t \iprod{\alpha_i}{\derive{u_i}{S}(x_i)}
            = 0
        \end{equation*}
        Thus every term is constant and in particular, as $S$ has no non-trivial LS, $\alpha_i$ or $u_i$ is zero.\\
        If one of the two is zero, the other can take all values.\hfill\qedsymbol
    \end{block}
\end{frame}

\begin{frame}{S-boxes without Linear Structures}
    \centering
    \begin{minipage}{0.72\textwidth}
    \begin{block}{Resistance of SPN against Subspace Trails, without linear structures}
    \centering
    The length $\ell$ of any subspace trail is upper bounded by
    \begin{equation*}
        \ell \leqslant \max_{U \in \set{\set{0}, \F_2^n}^t} \abs{\texttt{ComputeTrail}(F, U)}\;,
    \end{equation*}
    which needs $2^t$ evaluations of the \texttt{ComputeTrail} algorithm.
    \end{block}
    \end{minipage}
\end{frame}

\begin{frame}{S-boxes with Linear Structures}
    \centering
    Compared to the no-linear-structures-case, $V^\perp$ can now contain much more elements, namely\\
    all combinations of linear structures, such that their corresponding constants sum to zero.\\[1em]

    Instead, we can show that (for any not-trivially-insecure S-box) the subspace\\
    after the first S-box layer contains at least one element of a specific structure:
    \begin{equation*}
        W_{i,\alpha} = \set{0}^{i-1} \times \set{0, \alpha} \times \set{0}^{t-i}\;.
    \end{equation*}

    \begin{minipage}{0.69\textwidth}
    \begin{block}{Resistance of SPN against Subspace Trails, with linear structures}
    \centering
    The length $\ell$ of any subspace trail is upper bounded by
    \begin{equation*}
        \ell \leqslant \max_{W_{i,\alpha}} \abs{\texttt{ComputeTrail}(F^\prime, W_{i,\alpha})} + 1\;,
    \end{equation*}
    which needs $t \cdot 2^n$ evaluations of the \texttt{ComputeTrail} algorithm.
    \end{block}
    \end{minipage}

    \vspace{1em}
    Note: $F^\prime$ first applies the linear layer, then the S-box layer (b/c of the skipped first S-box layer).
\end{frame}

\section{Conclusion}
\begin{frame}{Conclusion}{Thanks for your attention!}
    \centering
    \begin{minipage}{0.5\textwidth}
    \begin{block}{Applications of \texttt{ComputeTrail}}
        \begin{itemize}
            \item Bound longest probability-one subspace trail
            \item Finding key-recovery strategies
        \end{itemize}
    \end{block}
    \begin{block}{Further Results on Subspace Trails}
        \begin{itemize}
            \item Link to Truncated Differentials
        \end{itemize}
    \end{block}
    \end{minipage}
    \begin{minipage}{0.45\textwidth}
        \centering
        \begin{figure}[!htb]
            \includegraphics[height=50mm]{data/flickr/questionmark.png}
        \end{figure}
    \end{minipage}
\end{frame}

%\begin{frame}[allowframebreaks]{References}
%    \tiny
%    \printbibliography{}
%\end{frame}

\end{document}
